<!DOCTYPE html>
<html lang="km">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á‚áŸ’ášá¿á„á¡á¶á“</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
    font-family:sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#fff;
    padding:16px;
}
.container{max-width:900px;margin:auto}
.header{text-align:center;margin-bottom:16px}
.header h1{color:#4ade80}
.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{
    flex:1;padding:12px;border:none;border-radius:10px;
    background:rgba(255,255,255,.15);color:#fff;font-weight:600
}
.tab.active{background:#4ade80;color:#0f2027}
.tab-content{display:none}
.tab-content.active{display:block}
.form-card,.inventory-item,.stat-card{
    background:rgba(255,255,255,.12);
    border-radius:14px;padding:16px;margin-bottom:12px
}
input{
    width:100%;padding:12px;border-radius:10px;
    border:1px solid rgba(255,255,255,.3);
    background:rgba(255,255,255,.2);color:#fff
}
label{color:#4ade80;font-weight:600;font-size:14px}
.btn{
    width:100%;padding:14px;border:none;border-radius:10px;
    background:#4ade80;color:#0f2027;font-weight:bold
}
.search-box{margin-bottom:12px}
.inventory-list{display:flex;flex-direction:column;gap:12px}
/* Layout */
.item-top{display:flex;gap:14px}
.item-left{flex:1}
.item-right{width:120px}
.item-image{width:100%;height:120px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,.3)}
.item-name{color:#4ade80;font-size:18px;font-weight:bold}
.item-code{font-size:13px;opacity:.8}
.detail-row{display:flex;gap:8px;margin:6px 0}
.detail-chip{padding:4px 10px;border-radius:20px;font-size:13px;font-weight:600;background:rgba(74,222,128,.15);border:1px solid rgba(74,222,128,.4);color:#4ade80}
.detail-chip.year{background:rgba(96,165,250,.15);border-color:rgba(96,165,250,.4);color:#60a5fa}
.detail-company{font-size:13px;opacity:.85}
/* Price */
.price-section{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;padding:10px;background:rgba(0,0,0,.25);border-radius:10px}
.price-value{font-weight:bold}
.buy{color:#fbbf24}
.sell{color:#4ade80}
.profit{color:#60a5fa}
.actions{display:flex;gap:8px;margin-top:10px}
.actions button{flex:1;padding:10px;border:none;border-radius:8px}
.edit{background:#60a5fa;color:#fff}
.delete{background:#ef4444;color:#fff}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.stat-value{font-size:24px;color:#4ade80;font-weight:bold}
/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);align-items:center;justify-content:center;padding:20px;z-index:100}
.modal.active{display:flex}
.modal-content{background:#203a43;border-radius:16px;padding:20px;width:100%;max-width:500px}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.close-btn{background:none;border:none;color:#fff;font-size:28px;cursor:pointer}
.modal-buttons{display:flex;gap:12px;margin-top:20px}
.modal-buttons button{flex:1;padding:12px;border:none;border-radius:10px;font-weight:bold}
.modal-btn-add{background:#4ade80;color:#0f2027}
.modal-btn-edit{background:#60a5fa;color:#fff}
.modal-btn-cancel{background:#ef4444;color:#fff}
</style>
</head>
<body>
<div class="container">
    <div class="header"><h1>ğŸš— á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á‚áŸ’ášá¿á„á¡á¶á“</h1></div>
    <div class="tabs">
        <button class="tab active" onclick="switchTab('stock')">ğŸ“¦ áŸáŸ’áá»á€</button>
        <button class="tab" onclick="switchTab('add')">â• á”á“áŸ’ááŸ‚á˜</button>
        <button class="tab" onclick="switchTab('stats')">ğŸ“Š áŸáŸ’áá·áá·</button>
    </div>
    <!-- STOCK -->
    <div id="stock-tab" class="tab-content active">
        <div class="search-box">
            <input id="searchInput" placeholder="ğŸ” Brake + Toyota + 2002" oninput="searchItems()">
        </div>
        <div id="inventoryList" class="inventory-list"></div>
    </div>
    <!-- ADD -->
    <div id="add-tab" class="tab-content">
        <div class="form-card">
            <form onsubmit="saveItem(event)">
                <label>á€áŸ’ášá»á˜á áŸŠá»á“</label><input id="company" required>
                <label>á€á¼áŠ</label><input id="productCode" required>
                <label>áˆáŸ’á˜áŸ„áŸ‡á‚áŸ’ášá¿á„</label><input id="partName" required>
                <label>á˜áŸ‰á¼áŠáŸ‚á›á¡á¶á“</label><input id="carModel" required>
                <label>á†áŸ’á“á¶áŸ†á˜áŸ‰á¼áŠáŸ‚á›</label><input id="modelYear" required>
                <label>ášá¼á”á—á¶á–</label><input type="file" id="productImage" accept="image/*">
                <label>áá˜áŸ’á›áŸƒá‘á·á‰</label><input type="number" id="buyPrice" required step="0.01">
                <label>áá˜áŸ’á›áŸƒá›á€áŸ‹</label><input type="number" id="sellPrice" required step="0.01">
                <button class="btn">ğŸ’¾ ášá€áŸ’áŸá¶á‘á»á€</button>
            </form>
        </div>
    </div>
    <!-- STATS -->
    <div id="stats-tab" class="tab-content">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalItems">0</div>á‘áŸ†á“á·á‰áŸášá»á”
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalProfit">$0</div>á…áŸ†ááŸá‰áŸášá»á”
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal (existing) -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>âœï¸ á€áŸ‚á”áŸ’ášáŸ‚</h2>
            <button class="close-btn" onclick="closeModal()">Ã—</button>
        </div>
        <form onsubmit="updateItem(event)">
            <input type="hidden" id="editId">
            <label>á€áŸ’ášá»á˜á áŸŠá»á“</label><input id="editCompany" required>
            <label>á€á¼áŠ</label><input id="editProductCode" required>
            <label>áˆáŸ’á˜áŸ„áŸ‡á‚áŸ’ášá¿á„</label><input id="editPartName" required>
            <label>á˜áŸ‰á¼áŠáŸ‚á›á¡á¶á“</label><input id="editCarModel" required>
            <label>á†áŸ’á“á¶áŸ†á˜áŸ‰á¼áŠáŸ‚á›</label><input id="editModelYear" required>
            <label>áá˜áŸ’á›áŸƒá‘á·á‰</label><input type="number" id="editBuyPrice" required step="0.01">
            <label>áá˜áŸ’á›áŸƒá›á€áŸ‹</label><input type="number" id="editSellPrice" required step="0.01">
            <button class="btn">ğŸ’¾ ášá€áŸ’áŸá¶á‘á»á€</button>
        </form>
    </div>
</div>

<!-- Duplicate Code Warning Modal (NEW) -->
<div id="duplicateModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>âš ï¸ ášá€áƒá¾á‰á€á¼áŠáŸáŸ’á‘á½á“</h2>
            <button class="close-btn" onclick="closeDuplicateModal()">Ã—</button>
        </div>
        <p>á€á¼áŠ "<span id="duplicateCode"></span>" á˜á¶á“ášá½á…á á¾á™á“áŸ…á€áŸ’á“á»á„á”áŸ’ášá–áŸá“áŸ’á’áŸ”<br>áá¾á¢áŸ’á“á€á…á„áŸ‹áŸ–</p>
        <div class="modal-buttons">
            <button class="modal-btn-add" onclick="addAsNew()">á”á“áŸ’ááŸ‚á˜á‡á¶ááŸ’á˜á¸</button>
            <button class="modal-btn-edit" onclick="editExisting()">á€áŸ‚á”áŸ’ášáŸ‚á…á¶áŸáŸ‹</button>
            <button class="modal-btn-cancel" onclick="closeDuplicateModal()">á”áŸ„áŸ‡á”á„áŸ‹</button>
        </div>
    </div>
</div>

<script>
let inventory = JSON.parse(localStorage.getItem("autoPartsInventory")) || [];
let currentSearch = [];
let pendingItem = null; // á‘á»á€ item áŠáŸ‚á›á€áŸ†á–á»á„ášá„áŸ‹á…á¶áŸ†á”á‰áŸ’á…á¼á› (á”á“áŸ’á‘á¶á”áŸ‹á–á¸á”á·á‘ modal)

function switchTab(name){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.getElementById(name+"-tab").classList.add('active');
    if(name==="stock") renderInventory();
    if(name==="stats") updateStats();
}

function saveItem(e){
    e.preventDefault();

    const productCode = document.getElementById('productCode').value.trim();

    // á–á·á“á·ááŸ’á™á˜á¾á›áá¶á˜á¶á“á€á¼áŠá“áŸáŸ‡ášá½á…á¬á“áŸ…
    const existingItem = inventory.find(i => i.productCode === productCode);

    if(existingItem){
        // á”á„áŸ’á á¶á‰ modal áŸá½ášá‡á˜áŸ’ášá¾áŸ
        document.getElementById('duplicateCode').textContent = productCode;
        document.getElementById('duplicateModal').classList.add('active');

        // ášá€áŸ’áŸá¶á‘á·á“áŸ’á“á“áŸá™á”ááŸ’ááŸ„áŸ‡á¢á¶áŸá“áŸ’á“áŸá˜áŸ’ášá¶á”áŸ‹á”áŸ’ášá¾á€áŸ’ášáŸ„á™
        pendingItem = {
            company: document.getElementById('company').value,
            productCode: productCode,
            partName: document.getElementById('partName').value,
            carModel: document.getElementById('carModel').value,
            modelYear: document.getElementById('modelYear').value,
            buyPrice: +document.getElementById('buyPrice').value,
            sellPrice: +document.getElementById('sellPrice').value,
            image: null
        };

        const file = document.getElementById('productImage').files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = () => { pendingItem.image = reader.result; };
            reader.readAsDataURL(file);
        }

        return; // áˆá”áŸ‹á“áŸ…á‘á¸á“áŸáŸ‡ ášá„áŸ‹á…á¶áŸ†á‡á˜áŸ’ášá¾áŸá–á¸ modal
    }

    // á”á¾á‚áŸ’á˜á¶á“á€á¼áŠáŸáŸ’á‘á½á“ â†’ á”á“áŸ’ááŸ‚á˜á’á˜áŸ’á˜áá¶
    addNewItem();
}

function addNewItem(){
    if(!pendingItem) return;

    pendingItem.id = Date.now();
    const file = document.getElementById('productImage').files[0];
    if(file && !pendingItem.image){
        const reader = new FileReader();
        reader.onload = () => {
            pendingItem.image = reader.result;
            finalizeAdd();
        };
        reader.readAsDataURL(file);
    } else {
        finalizeAdd();
    }

    function finalizeAdd(){
        inventory.push(pendingItem);
        localStorage.setItem("autoPartsInventory", JSON.stringify(inventory));
        document.querySelector('#add-tab form').reset();
        pendingItem = null;
        closeDuplicateModal();
        switchTab("stock");
    }
}

function addAsNew(){
    // á”á“áŸ’ááŸ‚á˜á‡á¶á’á˜áŸ’á˜áá¶ á‘áŸ„áŸ‡á”á¸á˜á¶á“á€á¼áŠáŠá¼á…á‚áŸ’á“á¶á€áŸáŠáŸ„á™
    addNewItem();
}

function editExisting(){
    const productCode = document.getElementById('productCode').value.trim();
    const existingItem = inventory.find(i => i.productCode === productCode);

    if(existingItem){
        // á”áŸ†á–áŸá‰á‘á·á“áŸ’á“á“áŸá™á…á¶áŸáŸ‹á˜á€á€áŸ’á“á»á„ form áŠá¾á˜áŸ’á”á¸á€áŸ‚
        document.getElementById('company').value = existingItem.company;
        document.getElementById('productCode').value = existingItem.productCode;
        document.getElementById('partName').value = existingItem.partName;
        document.getElementById('carModel').value = existingItem.carModel;
        document.getElementById('modelYear').value = existingItem.modelYear;
        document.getElementById('buyPrice').value = existingItem.buyPrice;
        document.getElementById('sellPrice').value = existingItem.sellPrice;

        // á”á¾á˜á¶á“ášá¼á”á—á¶á–á…á¶áŸáŸ‹ á¢á¶á…á”á„áŸ’á á¶á‰ (ááŸ‚ file input á˜á·á“á¢á¶á… set value áŠáŸ„á™áŸá»áœááŸ’áá·á—á¶á–)
        // á¢áŸ’á“á€á¢á¶á…á”á“áŸ’ááŸ‚á˜ preview á”á“áŸ’ááŸ‚á˜á”á¾á…á„áŸ‹

        alert("á‘á·á“áŸ’á“á“áŸá™á…á¶áŸáŸ‹ááŸ’ášá¼áœá”á¶á“á”áŸ†á–áŸá‰á˜á€á á¾á™áŸ” áŸá¼á˜á€áŸ‚á”áŸ’ášáŸ‚ ášá½á…á…á»á… 'ášá€áŸ’áŸá¶á‘á»á€' á˜áŸ’áá„á‘áŸ€ááŸ”");
    }
    closeDuplicateModal();
}

function closeDuplicateModal(){
    document.getElementById('duplicateModal').classList.remove('active');
    pendingItem = null;
}

// á˜á»áá„á¶ášáŠáŸ‚á›á“áŸ…áŸá›áŸ‹áŠáŠáŸ‚á›
function renderInventory(){
    let list = inventory.filter(i =>
        currentSearch.length === 0 ||
        currentSearch.some(term =>
            i.partName.toLowerCase().includes(term) ||
            i.carModel.toLowerCase().includes(term) ||
            i.modelYear.toLowerCase().includes(term) ||
            i.company.toLowerCase().includes(term) ||
            i.productCode.toLowerCase().includes(term)
        )
    );
    inventoryList.innerHTML = list.map(i => {
        let p = i.sellPrice - i.buyPrice;
        return `
        <div class="inventory-item">
            <div class="item-top">
                <div class="item-left">
                    <div class="item-name">${i.partName}</div>
                    <div class="item-code">${i.productCode}</div>
                    <div class="detail-row">
                        <span class="detail-chip">${i.carModel}</span>
                        <span class="detail-chip year">${i.modelYear}</span>
                    </div>
                    <div class="detail-company">${i.company}</div>
                </div>
                <div class="item-right">
                    ${i.image ? `<img src="${i.image}" class="item-image">` : ""}
                </div>
            </div>
            <div class="price-section">
                <div><div class="price-value buy">$${i.buyPrice}</div>á‘á·á‰</div>
                <div><div class="price-value sell">$${i.sellPrice}</div>á›á€áŸ‹</div>
                <div><div class="price-value profit">$${p}</div>á…áŸ†ááŸá‰</div>
            </div>
            <div class="actions">
                <button class="edit" onclick="openEdit(${i.id})">âœï¸</button>
                <button class="delete" onclick="deleteItem(${i.id})">ğŸ—‘ï¸</button>
            </div>
        </div>`;
    }).join("");
}

function searchItems(){
    const terms = document.getElementById('searchInput').value.toLowerCase().split("+").map(s=>s.trim()).filter(Boolean);
    currentSearch = terms;
    renderInventory();
}

function openEdit(id){
    const item = inventory.find(i => i.id === id);
    if(!item) return;
    document.getElementById('editId').value = item.id;
    document.getElementById('editCompany').value = item.company;
    document.getElementById('editProductCode').value = item.productCode;
    document.getElementById('editPartName').value = item.partName;
    document.getElementById('editCarModel').value = item.carModel;
    document.getElementById('editModelYear').value = item.modelYear;
    document.getElementById('editBuyPrice').value = item.buyPrice;
    document.getElementById('editSellPrice').value = item.sellPrice;
    document.getElementById('editModal').classList.add('active');
}

function updateItem(e){
    e.preventDefault();
    const id = parseInt(document.getElementById('editId').value);
    const index = inventory.findIndex(i => i.id === id);
    if(index === -1) return;
    inventory[index] = {
        ...inventory[index],
        company: document.getElementById('editCompany').value,
        productCode: document.getElementById('editProductCode').value,
        partName: document.getElementById('editPartName').value,
        carModel: document.getElementById('editCarModel').value,
        modelYear: document.getElementById('editModelYear').value,
        buyPrice: +document.getElementById('editBuyPrice').value,
        sellPrice: +document.getElementById('editSellPrice').value
    };
    localStorage.setItem("autoPartsInventory", JSON.stringify(inventory));
    closeModal();
    renderInventory();
    updateStats();
}

function closeModal(){
    document.getElementById('editModal').classList.remove('active');
}

function deleteItem(id){
    if(confirm("á›á»á”á‘áŸ†á“á·á‰á“áŸáŸ‡á˜áŸ‚á“á‘áŸ?")){
        inventory = inventory.filter(i => i.id !== id);
        localStorage.setItem("autoPartsInventory", JSON.stringify(inventory));
        renderInventory();
        updateStats();
    }
}

function updateStats(){
    const totalProfit = inventory.reduce((s,i) => s + (i.sellPrice - i.buyPrice), 0);
    document.getElementById('totalItems').textContent = inventory.length;
    document.getElementById('totalProfit').textContent = "$" + totalProfit.toFixed(2);
}

// Init
renderInventory();
updateStats();
</script>
</body>
</html>