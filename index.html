<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Parts Management System</title>
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/Test-app/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/Test-app/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/Test-app/favicon-16x16.png">
    <link rel="manifest" href="/Test-app/site.webmanifest">
    <link rel="mask-icon" href="/Test-app/safari-pinned-tab.svg" color="#0f2027">
    <link rel="shortcut icon" href="/Test-app/favicon.ico">
    <meta name="msapplication-TileColor" content="#0f2027">
    <meta name="msapplication-config" content="/Test-app/browserconfig.xml">
    <meta name="theme-color" content="#0f2027">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Parts Manager">
    
    <!-- CSS & Fonts -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- QRCode library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header & Theme Toggle -->
        <div class="header">
            <h1><i class="fas fa-car"></i> Auto Parts Management System</h1>
            <div class="theme-toggle">
                <label>
                    <input type="checkbox" v-model="isLightMode" @change="toggleTheme">
                    <span>{{ isLightMode ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode' }}</span>
                </label>
            </div>
            <div class="install-btn" v-if="showInstallBtn" @click="installPWA">
                <i class="fas fa-download"></i> Install App
            </div>
        </div>

        <div class="container">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab" :class="{ active: activeTab === 'add' }" @click="activeTab = 'add'">
                    <i class="fas fa-plus"></i> Add Part
                </button>
                <button class="tab" :class="{ active: activeTab === 'stock' }" @click="activeTab = 'stock'">
                    <i class="fas fa-boxes"></i> Stock
                </button>
                <button class="tab" :class="{ active: activeTab === 'stats' }" @click="activeTab = 'stats'">
                    <i class="fas fa-chart-bar"></i> Statistics
                </button>
                <button class="tab" :class="{ active: activeTab === 'bulk' }" @click="activeTab = 'bulk'">
                    <i class="fas fa-upload"></i> Import/Export
                </button>
                <button class="tab" :class="{ active: activeTab === 'invoice' }" @click="switchToInvoiceTab">
                    <i class="fas fa-file-invoice-dollar"></i> Invoice
                </button>
            </div>

            <!-- Add Part Tab -->
            <div v-if="activeTab === 'add'" class="tab-content active">
                <div class="form-card">
                    <form @submit.prevent="saveItem">
                        <div class="form-row">
                            <div>
                                <label for="company"><i class="fas fa-building"></i> Company</label>
                                <input type="text" id="company" v-model="form.company" required>
                            </div>
                            <div>
                                <label for="productCode"><i class="fas fa-barcode"></i> Part Code</label>
                                <input type="text" id="productCode" v-model="form.productCode" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="partName"><i class="fas fa-cog"></i> Part Name</label>
                                <input type="text" id="partName" v-model="form.partName" required>
                            </div>
                            <div>
                                <label for="carModel"><i class="fas fa-car-side"></i> Car Model</label>
                                <input type="text" id="carModel" v-model="form.carModel" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="modelYear"><i class="fas fa-calendar-alt"></i> Model Year</label>
                                <input type="text" id="modelYear" v-model="form.modelYear" required>
                            </div>
                            <div>
                                <label for="quantity"><i class="fas fa-box"></i> Quantity</label>
                                <input type="number" id="quantity" v-model="form.quantity" min="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="buyPrice"><i class="fas fa-dollar-sign"></i> Purchase Price ($)</label>
                                <input type="number" id="buyPrice" v-model="form.buyPrice" step="0.01" min="0" required>
                            </div>
                            <div>
                                <label for="sellPrice"><i class="fas fa-tag"></i> Selling Price ($)</label>
                                <input type="number" id="sellPrice" v-model="form.sellPrice" step="0.01" min="0" required>
                            </div>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i> Save Part
                        </button>
                    </form>
                </div>
            </div>

            <!-- Stock Tab -->
            <div v-if="activeTab === 'stock'" class="tab-content active">
                <div class="search-box">
                    <input type="text" v-model="searchQuery" placeholder="Search parts...">
                </div>
                
                <div class="filter-section">
                    <div class="filter-row">
                        <select v-model="selectedCompany" @change="applyFilters">
                            <option value="">All Companies</option>
                            <option v-for="company in uniqueCompanies" :value="company">{{ company }}</option>
                        </select>
                        
                        <select v-model="selectedCarModel" @change="applyFilters">
                            <option value="">All Car Models</option>
                            <option v-for="model in uniqueCarModels" :value="model">{{ model }}</option>
                        </select>
                        
                        <select v-model="selectedYear" @change="applyFilters">
                            <option value="">All Model Years</option>
                            <option v-for="year in uniqueYears" :value="year">{{ year }}</option>
                        </select>
                        
                        <button class="clear-filters" @click="clearFilters">
                            <i class="fas fa-times"></i> Clear Filters
                        </button>
                    </div>
                    
                    <!-- Active Filters Display -->
                    <div v-if="hasActiveFilters" class="active-filters">
                        <span class="filter-tag" v-if="selectedCompany">
                            Company: {{ selectedCompany }}
                            <span @click="selectedCompany = ''">√ó</span>
                        </span>
                        <span class="filter-tag" v-if="selectedCarModel">
                            Model: {{ selectedCarModel }}
                            <span @click="selectedCarModel = ''">√ó</span>
                        </span>
                        <span class="filter-tag" v-if="selectedYear">
                            Year: {{ selectedYear }}
                            <span @click="selectedYear = ''">√ó</span>
                        </span>
                    </div>
                </div>
                
                <div class="inventory-list">
                    <div v-for="item in filteredInventory" :key="item.id" class="inventory-item">
                        <div class="item-top">
                            <div class="item-left">
                                <div class="item-name">{{ item.partName }}</div>
                                <div class="item-code">Code: {{ item.productCode }} | Company: {{ item.company }}</div>
                                <div class="detail-row">
                                    <span class="detail-chip">{{ item.carModel }}</span>
                                    <span class="detail-chip year">{{ item.modelYear }}</span>
                                    <span class="detail-chip" :class="{ 'low-stock': item.quantity <= 2 }">
                                        <i class="fas fa-box"></i> {{ item.quantity }}
                                    </span>
                                </div>
                                <div class="detail-company">
                                    <i class="fas fa-building"></i> {{ item.company }}
                                </div>
                            </div>
                        </div>
                        <div class="price-section">
                            <div class="price-value buy">
                                <div>Purchase</div>
                                <div>${{ item.buyPrice.toFixed(2) }}</div>
                            </div>
                            <div class="price-value sell">
                                <div>Selling</div>
                                <div>${{ item.sellPrice.toFixed(2) }}</div>
                            </div>
                            <div class="price-value profit">
                                <div>Profit</div>
                                <div>${{ (item.sellPrice - item.buyPrice).toFixed(2) }}</div>
                            </div>
                        </div>
                        <div class="actions">
                            <button class="edit" @click="openEdit(item.id)">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="delete" @click="deleteItem(item.id)">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <div class="qr-section">
                                <button class="qr-btn" @click="generateQR(item)">
                                    <i class="fas fa-qrcode"></i> QR
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn export-btn" @click="exportToCSV">
                    <i class="fas fa-file-export"></i> Export to CSV
                </button>
            </div>

            <!-- Statistics Tab -->
            <div v-if="activeTab === 'stats'" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Items</div>
                        <div class="stat-value">{{ totalItems }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Cost</div>
                        <div class="stat-value">${{ totalCost.toFixed(2) }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Profit</div>
                        <div class="stat-value">${{ totalProfit.toFixed(2) }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Low Stock Items</div>
                        <div class="stat-value">{{ lowStockCount }}</div>
                    </div>
                </div>
            </div>
            
            <!-- Bulk Operations Tab -->
            <div v-if="activeTab === 'bulk'" class="tab-content active">
                <div class="bulk-actions">
                    <h3><i class="fas fa-file-import"></i> Import Parts from CSV File</h3>
                    <p>Import multiple parts at once using CSV file</p>

                    <label class="file-label" for="csvFile">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div>Click to select CSV file</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Or drag and drop file here</div>
                    </label>
                    <input type="file" id="csvFile" class="file-input" accept=".csv" @change="handleImport">

                    <div class="bulk-buttons">
                        <button class="bulk-btn template-btn" @click="downloadTemplate">
                            <i class="fas fa-file-download"></i> Download Template
                        </button>
                        <button class="bulk-btn export-btn-bulk" @click="exportAllToCSV">
                            <i class="fas fa-file-export"></i> Export All
                        </button>
                    </div>

                    <div v-if="importResults" class="import-results">
                        <h4><i class="fas fa-clipboard-check"></i> Import Results</h4>
                        <p class="result-success">Successfully imported: {{ importResults.success }}/{{ importResults.total }}</p>
                        <p v-if="importResults.errors.length" class="result-error">
                            Errors: {{ importResults.errors.length }}
                        </p>
                        <div v-for="(error, idx) in importResults.errors" :key="idx" class="result-warning">
                            {{ error }}
                        </div>
                        <button @click="importResults = null" style="margin-top: 10px;">
                            <i class="fas fa-times"></i> Clear Results
                        </button>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3><i class="fas fa-info-circle"></i> Instructions</h3>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Download template file by clicking "Download Template" button</li>
                        <li>Fill part information in CSV file</li>
                        <li>Select file by clicking on gray area</li>
                        <li>Parts will be imported automatically</li>
                    </ol>
                    <p style="margin-top: 15px; font-style: italic;">
                        <i class="fas fa-lightbulb"></i> Note: If part code already exists, it will update old data
                    </p>
                </div>
            </div>

            <!-- Invoice Tab -->
            <div v-if="activeTab === 'invoice'" class="tab-content active">
                <div class="invoice-controls">
                    <!-- Invoice Header -->
                    <div class="invoice-header">
                        <div>
                            <h3><i class="fas fa-file-invoice-dollar"></i> Create Invoice</h3>
                            <p class="invoice-number-display">Invoice Number: <strong>{{ invoice.invoiceNumber }}</strong></p>
                        </div>
                        <div class="invoice-header-actions">
                            <button class="btn" @click="createNewInvoice">
                                <i class="fas fa-plus"></i> New Invoice
                            </button>
                            <button class="btn" @click="saveInvoiceToHistory" :disabled="invoice.items.length === 0">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>

                    <!-- Customer Details -->
                    <div class="customer-details form-card">
                        <h4><i class="fas fa-user"></i> Customer Information</h4>
                        <div class="form-row">
                            <div>
                                <label for="customerName">Customer Name *</label>
                                <input type="text" id="customerName" v-model="invoice.customerName" required placeholder="Enter customer name">
                            </div>
                            <div>
                                <label for="invoiceDate">Date</label>
                                <input type="date" id="invoiceDate" v-model="invoice.date">
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="customerPhone">Phone Number</label>
                                <input type="tel" id="customerPhone" v-model="invoice.customerPhone" placeholder="Phone number">
                            </div>
                            <div>
                                <label for="invoiceNumber">Invoice Number</label>
                                <input type="text" id="invoiceNumber" :value="invoice.invoiceNumber" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Add Items Section -->
                    <div class="add-items-section form-card">
                        <h4><i class="fas fa-cart-plus"></i> Add Items to Invoice</h4>
                        
                        <!-- Method 1: Search Inventory Items -->
                        <div class="add-method">
                            <div class="method-header">
                                <h5><i class="fas fa-search"></i> Search Items from Stock</h5>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label for="itemSearch">Search Items</label>
                                    <input type="text" id="itemSearch" v-model="itemSearch" 
                                           @input="searchItemsForInvoice" 
                                           placeholder="Search by code or part name...">
                                </div>
                                <div>
                                    <label>Quantity</label>
                                    <input type="number" v-model="selectedInventoryItem.quantity" min="1" value="1">
                                </div>
                                <div>
                                    <label>&nbsp;</label>
                                    <button class="btn" @click="addInventoryItem" :disabled="!selectedSearchItem">
                                        <i class="fas fa-plus"></i> Add from Stock
                                    </button>
                                </div>
                            </div>

                            <!-- Search Results -->
                            <div v-if="searchResults.length > 0" class="search-results">
                                <div v-for="item in searchResults" :key="item.id" 
                                     class="search-result-item" 
                                     :class="{ selected: selectedSearchItem?.id === item.id }"
                                     @click="selectSearchItem(item)">
                                    <div class="result-info">
                                        <div class="result-name">{{ item.partName }}</div>
                                        <div class="result-details">
                                            <span class="result-code">{{ item.productCode }}</span>
                                            <span class="result-price">${{ item.sellPrice.toFixed(2) }}</span>
                                            <span class="result-stock">Stock: {{ item.quantity }}</span>
                                        </div>
                                    </div>
                                    <div class="result-action">
                                        <i class="fas fa-check" v-if="selectedSearchItem?.id === item.id"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Method 2: Add Manual Item -->
                        <div class="add-method">
                            <div class="method-header">
                                <h5><i class="fas fa-edit"></i> Add Manual Item</h5>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label for="manualItemName">Item Name *</label>
                                    <input type="text" id="manualItemName" v-model="manualItem.name" placeholder="Item name">
                                </div>
                                <div>
                                    <label for="manualItemPrice">Price ($)</label>
                                    <input type="number" id="manualItemPrice" v-model="manualItem.price" step="0.01" min="0" placeholder="0.00">
                                </div>
                                <div>
                                    <label for="manualItemQuantity">Quantity</label>
                                    <input type="number" id="manualItemQuantity" v-model="manualItem.quantity" min="1" value="1">
                                </div>
                                <div>
                                    <label>&nbsp;</label>
                                    <button class="btn" @click="addManualItem" :disabled="!manualItem.name || !manualItem.price">
                                        <i class="fas fa-plus-circle"></i> Add Manual
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Items List -->
                    <div v-if="invoice.items.length > 0" class="invoice-items">
                        <h4><i class="fas fa-list"></i> Items in Invoice ({{ invoice.items.length }})</h4>
                        <div class="invoice-table">
                            <div class="invoice-table-header">
                                <div>No.</div>
                                <div>Description</div>
                                <div>Quantity</div>
                                <div>Unit Price</div>
                                <div>Total</div>
                                <div>Actions</div>
                            </div>
                            <div v-for="(item, index) in invoice.items" :key="index" class="invoice-table-row">
                                <div>{{ index + 1 }}</div>
                                <div>
                                    <div class="item-desc">{{ item.description }}</div>
                                    <div v-if="item.code" class="item-code">Code: {{ item.code }}</div>
                                    <div v-if="item.type" class="item-type">Type: {{ item.type }}</div>
                                </div>
                                <div>
                                    <input type="number" v-model="item.quantity" min="1" 
                                           @change="updateInvoiceTotal" class="quantity-input">
                                </div>
                                <div>
                                    <input type="number" v-model="item.unitPrice" step="0.01" min="0" 
                                           @change="updateInvoiceTotal" class="price-input">
                                </div>
                                <div class="item-total">${{ (item.quantity * item.unitPrice).toFixed(2) }}</div>
                                <div>
                                    <button class="delete-small" @click="removeInvoiceItem(index)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Invoice Totals -->
                        <div class="invoice-totals">
                            <div class="total-row">
                                <span>Subtotal</span>
                                <span>${{ invoice.subtotal.toFixed(2) }}</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Grand Total</span>
                                <span>${{ invoice.grandTotal.toFixed(2) }}</span>
                            </div>
                        </div>
                        
                        <!-- Invoice Actions -->
                        <div class="invoice-actions">
                            <button class="btn" @click="printInvoice">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="btn" @click="saveInvoiceAsImage">
                                <i class="fas fa-image"></i> Save as Image
                            </button>
                            <button class="btn" @click="saveInvoiceAsPDF">
                                <i class="fas fa-file-pdf"></i> Save as PDF
                            </button>
                            <button class="btn" @click="clearInvoice">
                                <i class="fas fa-times"></i> Clear Invoice
                            </button>
                        </div>
                    </div>
                    
                    <!-- No Items Message -->
                    <div v-else class="no-items-message">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Invoice is empty. Please add items from above!</p>
                    </div>

                    <!-- Invoice History -->
                    <div v-if="invoiceHistory.length > 0" class="invoice-history">
                        <h4><i class="fas fa-history"></i> Invoice History ({{ invoiceHistory.length }})</h4>
                        <div class="history-list">
                            <div v-for="(inv, index) in invoiceHistory.slice().reverse()" :key="index" class="history-item">
                                <div class="history-header">
                                    <div class="history-customer">
                                        <strong>{{ inv.customerName || 'Unknown Customer' }}</strong>
                                        <small>{{ inv.date }}</small>
                                    </div>
                                    <div class="history-amount">
                                        ${{ inv.grandTotal.toFixed(2) }}
                                        <small>{{ inv.items.length }} items</small>
                                    </div>
                                </div>
                                <div class="history-actions">
                                    <button @click="viewInvoiceHistory(inv)" class="small-btn view-btn">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button @click="printInvoiceFromHistory(inv)" class="small-btn print-btn">
                                        <i class="fas fa-print"></i> Print
                                    </button>
                                    <button @click="deleteInvoiceHistory(inv.id)" class="small-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Preview (hidden, for printing/saving) -->
                <div ref="invoicePreview" class="invoice-preview hidden">
                    <div class="preview-header">
                        <h2>INVOICE</h2>
                        <div class="preview-info">
                            <p><strong>Customer:</strong> {{ invoice.customerName }}</p>
                            <p><strong>Date:</strong> {{ invoice.date }}</p>
                            <p><strong>Invoice Number:</strong> {{ invoice.invoiceNumber }}</p>
                            <p v-if="invoice.customerPhone"><strong>Phone:</strong> {{ invoice.customerPhone }}</p>
                        </div>
                    </div>
                    
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Description</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in invoice.items" :key="index">
                                <td>{{ index + 1 }}</td>
                                <td>{{ item.description }}{{ item.code ? ' (' + item.code + ')' : '' }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>${{ item.unitPrice.toFixed(2) }}</td>
                                <td>${{ (item.quantity * item.unitPrice).toFixed(2) }}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="preview-totals">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span>${{ invoice.subtotal.toFixed(2) }}</span>
                        </div>
                        <div class="total-row grand">
                            <span>Grand Total:</span>
                            <span>${{ invoice.grandTotal.toFixed(2) }}</span>
                        </div>
                    </div>
                    
                    <div class="preview-footer">
                        <p>Thank you for your purchase!</p>
                        <p>Please contact us directly if there are any issues with the invoice.</p>
                    </div>
                </div>
            </div>

            <!-- Duplicate Modal -->
            <div v-if="showDuplicateModal" class="modal active">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> Part Code "{{ duplicateItem?.productCode }}" already exists!</h2>
                        <button class="close-btn" @click="closeDuplicateModal">&times;</button>
                    </div>
                    <p>Do you want to add as new item or edit existing item?</p>
                    <div class="modal-buttons">
                        <button class="modal-btn-add" @click="addAsNew">
                            <i class="fas fa-plus"></i> Add New
                        </button>
                        <button class="modal-btn-edit" @click="editExisting">
                            <i class="fas fa-edit"></i> Edit Existing
                        </button>
                        <button class="modal-btn-cancel" @click="closeDuplicateModal">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Modal -->
            <div v-if="showEditModal" class="modal active">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-edit"></i> Edit Part</h2>
                        <button class="close-btn" @click="closeEditModal">&times;</button>
                    </div>
                    <form @submit.prevent="updateItem">
                        <input type="hidden" v-model="editForm.id">
                        <div class="form-row">
                            <div>
                                <label>Company</label>
                                <input type="text" v-model="editForm.company" required>
                            </div>
                            <div>
                                <label>Part Code</label>
                                <input type="text" v-model="editForm.productCode" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>Part Name</label>
                                <input type="text" v-model="editForm.partName" required>
                            </div>
                            <div>
                                <label>Car Model</label>
                                <input type="text" v-model="editForm.carModel" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>Model Year</label>
                                <input type="text" v-model="editForm.modelYear" required>
                            </div>
                            <div>
                                <label>Quantity</label>
                                <input type="number" v-model="editForm.quantity" min="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>Purchase Price ($)</label>
                                <input type="number" v-model="editForm.buyPrice" step="0.01" min="0" required>
                            </div>
                            <div>
                                <label>Selling Price ($)</label>
                                <input type="number" v-model="editForm.sellPrice" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="modal-buttons">
                            <button type="submit" class="modal-btn-add">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button type="button" class="modal-btn-cancel" @click="closeEditModal">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- QR Modal -->
            <div v-if="showQRModal" class="modal active">
                <div class="modal-content qr-modal">
                    <div class="modal-header">
                        <h2><i class="fas fa-qrcode"></i> QR Code for {{ qrItem.partName }}</h2>
                        <button class="close-btn" @click="closeQRModal">&times;</button>
                    </div>
                    <div class="qr-container">
                        <div class="qr-code">
                            <!-- QR will be generated here -->
                        </div>
                        <div class="qr-info">
                            <p><strong>Part Name:</strong> {{ qrItem.partName }}</p>
                            <p><strong>Code:</strong> {{ qrItem.productCode }}</p>
                            <p><strong>Car:</strong> {{ qrItem.carModel }} ({{ qrItem.modelYear }})</p>
                            <p><strong>Selling Price:</strong> ${{ qrItem.sellPrice.toFixed(2) }}</p>
                            <p><strong>Stock:</strong> {{ qrItem.quantity }}</p>
                            <p><strong>Company:</strong> {{ qrItem.company }}</p>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-btn-add" @click="downloadQR">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="modal-btn-edit" @click="printQR">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="modal-btn-cancel" @click="closeQRModal">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Test-app/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // PWA installation prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                setTimeout(() => {
                    if (confirm('Would you like to install this app on your device?')) {
                        e.prompt();
                    }
                }, 3000);
            }
        });
    </script>
</body>
</html>
